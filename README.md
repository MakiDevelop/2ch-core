# 2ch-core

2ch-core 是 2ch.tw 的核心後端服務，負責匿名即時討論平台的主要業務邏輯與系統能力。  
本專案刻意對齊日本 2ch / 5ch 的設計哲學：**簡單、線性、耐用**，以「可實際上線並長期演進」為第一優先。

這不是範例專案，也不是技術展示用 repo，而是一個已可實際運作的匿名留言板核心。

---

## 專案定位

- 匿名即時討論平台後端核心
- 高雜訊使用者輸入的防禦與正規化
- 2ch-style thread / reply（僅一層回覆）
- 可演進的防濫用與治理機制

---

## 設計哲學（重要）

- **只支援一層 reply，不支援 reply 的 reply**
- 系統不追蹤「回誰」，引用交由文化（例如 `>>123`）
- 資料模型以「線性 + 穩定」為優先，而非巢狀結構
- 寧願簡單耐用，也不提早為未來過度設計

---

## v1 Board Seed（初始討論版清單）

v1 階段的 Board 採取 **「少量、通用、可承受噪音」** 原則。  
這些 Board 的角色是 **系統減壓器**，而非社群身分或興趣標籤。

> Board 是為了讓系統撐得住話題，不是為了讓使用者找到歸屬感。

### 核心通用板（必備）

1. **雜談**  
   任何無法分類、也不想分類的話題入口。  
   此板的存在目的是保護其他所有板。

2. **時事**  
   新聞、政治、社會事件與公共議題。  
   高衝突、高流量，必須集中處理。

3. **問卦 / 問題**  
   低門檻提問、求解、請益。  
   用來避免雜談板被問題洗版。

4. **抱怨 / 情緒**  
   發洩情緒、負面經驗、不滿與牢騷。  
   此板不存在，其他板一定會爆。

---

### 興趣導向板（邊界刻意寬鬆）

5. **ACG / 娛樂**  
   動畫、漫畫、遊戲、影視、追星與流行文化。

6. **科技 / 網路**  
   程式、AI、3C、網路文化與科技趨勢。

7. **生活**  
   工作、感情、家庭、日常瑣事與人生觀察。

---

### 風險隔離板（治理用途）

8. **成人 / NSFW**  
   成人內容集中處理，避免污染其他板。

9. **爭議 / 炎上**  
   容易引戰、價值衝突、高對立話題的集中區。  
   此板的目的在於「隔離」，而非鼓勵。

---

### 預留與緩衝板

10. **其他 / 測試**  
    系統測試、臨時導流、或尚未確定去向的話題。

---

### Board 使用原則（v1）

- 使用者 **不能自行創板**
- Board 可被合併、關閉、或重新定位
- Board 名稱刻意避免強烈身分認同
- 若某主題長期佔用單一 Board 的大量流量，才考慮被動切板

此清單是 **v1 的起始配置，而非最終結構**。

---

## 目前功能（v0.1）

- 匿名發文（Thread / Reply）
- Thread + one-level replies（2ch 正統模式）
- 基本 Guard（長度限制、rate limit）
- 真實來源 IP Hash（proxy-ready）
- REST API（Express）
- PostgreSQL persistence
- Docker 開發環境

---

## 技術主線

### 語言
- **TypeScript（主線）**：所有同步請求與核心邏輯
- Python（未來）：僅用於非同步或批次任務，不進主請求路徑

### 基礎設施
- Runtime：Node.js
- Database：PostgreSQL
- Cache / Realtime（規劃）：Redis
- Container：Docker

---

## 架構概念

專案採用「責任明確分層」的 Agent-based 結構，但不追求形式上的複雜度。

- API：HTTP 介面與請求協調
- Guard：防濫用、限流、輸入正規化
- Persistence：資料存取
- Realtime（預留）：即時推播
- Domain（預留）：業務規則

---

## API 概覽

### POST /posts
建立主貼或回覆。

```json
{
  "content": "Hello world",
  "parentId": 1
}
```

- `parentId` 為選填
- 不提供即時驗證 parent 是否存在（對齊 2ch 行為）

---

### GET /posts
取得最新主貼（threads）。

```json
{
  "items": [
    {
      "id": 1,
      "content": "Thread",
      "parentId": null
    }
  ]
}
```

---

## 開發與啟動

```bash
npm install
docker compose up -d
npx tsx src/main.ts
```

---

## 專案階段

- **v0.1**：單一服務、可實際上線（目前）
- v1：引入 Redis 強化保護與即時能力
- v1.5：非同步 Worker（Python）
- v2：依需求拆分為多服務

---

## 開發原則

1. 先能跑、再變好
2. 架構服務於產品，而非炫技
3. 主請求路徑保持單一心智模型
4. 所有設計皆可被替換與演進

---

## 授權

尚未決定授權方式，暫不開放使用或散佈。